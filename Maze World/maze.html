<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey Through India's Constitution</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --saffron: #FF9933;
            --navy: #000080;
            --green: #138808;
            --white: #ffffff;
            --gold: #FFD700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(
                45deg,
                rgba(255,153,51,0.1),
                rgba(255,255,255,0.1),
                rgba(19,136,8,0.1)
            );
            min-height: 100vh;
        }

        #game-container {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 3px solid var(--navy);
            z-index: 10;
            max-width: 320px;
            backdrop-filter: blur(10px);
        }

        .game-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .chakra-spin {
            width: 40px;
            height: 40px;
            animation: spin 10s linear infinite;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        h1 {
            color: var(--navy);
            font-size: 24px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(0,0,128,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 14px;
            color: var(--navy);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--saffron);
        }

        #progress {
            color: var(--green);
            font-size: 15px;
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
            background: rgba(19,136,8,0.1);
            text-align: center;
        }

        .controls-panel {
            background: rgba(0,0,0,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .controls-title {
            font-size: 16px;
            color: var(--navy);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .control-key {
            background: var(--white);
            border: 2px solid var(--navy);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            color: var(--navy);
        }

        #quiz-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, var(--saffron), var(--white), var(--green));
            margin: 5% auto;
            padding: 30px;
            border: 4px solid var(--navy);
            width: 90%;
            max-width: 700px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
        }

        .quiz-header {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #quiz-question {
            color: var(--navy);
            font-size: 20px;
            font-weight: 500;
            line-height: 1.4;
        }

        .modal-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .modal-option {
            background: rgba(255,255,255,0.9);
            padding: 15px 20px;
            border: 2px solid var(--navy);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }

        .modal-option:hover {
            background: var(--navy);
            color: var(--white);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 5;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .message-box {
            background: var(--white);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .message-title {
            color: var(--navy);
            font-size: 24px;
            margin-bottom: 15px;
        }

        .message-content {
            color: #666;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--navy);
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #minimap {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--navy);
            z-index: 10;
        }

        .level-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid var(--navy);
            z-index: 10;
            font-weight: 500;
            color: var(--navy);
        }

        @media (max-width: 768px) {
            #game-container {
                top: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
            }

            .modal-content {
                margin: 2% auto;
                padding: 20px;
                width: 95%;
            }

            .modal-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="game-start-modal" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255,153,51,0.9), rgba(19,136,8,0.9));
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    font-family: 'Poppins', sans-serif;
    padding: 20px;
    box-sizing: border-box;
">
    <div style="
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 450px;
        width: 100%;
        text-align: center;
        box-shadow: 0 15px 50px rgba(0,0,0,0.9);
        position: relative;
        overflow: hidden;
    ">
        <div style="
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FF9933, #000080);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
        ">
            <img src="https://upload.wikimedia.org/wikipedia/commons/1/17/Ashoka_Chakra.svg" 
                 alt="Ashoka Chakra" 
                 style="width: 70%; animation: spin 10s linear infinite;"
            >
        </div>

        <h1 style="
            color: #000080;
            margin-top: 50px;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
        ">Constitutional Journey</h1>
        
        <div style="margin-bottom: 20px;">
            <input 
                type="text" 
                id="player-name" 
                required 
                placeholder="Enter Your Name"
                style="
                    width: 100%;
                    padding: 12px 15px;
                    border-radius: 8px;
                    border: 2px solid #FF9933;
                    font-size: 16px;
                    outline: none;
                    transition: all 0.3s ease;
                "
            >
        </div>

        <div style="
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
        ">
            <h3 style="
                color: #000080; 
                margin-bottom: 10px;
                font-size: 18px;
            ">
                Game Instructions
            </h3>
            <ul style="
                list-style-type: none; 
                padding: 0;
                margin: 0;
            ">
                <li style="
                    margin-bottom: 8px;
                    display: flex;
                    align-items: center;
                    color: #333;
                ">
                    <span style="
                        margin-right: 10px;
                        color: #FF9933;
                        font-weight: bold;
                    ">•</span> 
                    Navigate using Arrow Keys
                </li>
                <li style="
                    margin-bottom: 8px;
                    display: flex;
                    align-items: center;
                    color: #333;
                ">
                    <span style="
                        margin-right: 10px;
                        color: #FF9933;
                        font-weight: bold;
                    ">•</span> 
                    Collect constitutional coins
                </li>
                <li style="
                    margin-bottom: 8px;
                    display: flex;
                    align-items: center;
                    color: #333;
                ">
                    <span style="
                        margin-right: 10px;
                        color: #FF9933;
                        font-weight: bold;
                    ">•</span> 
                    Answer trivia to progress
                </li>
                <li style="
                    display: flex;
                    align-items: center;
                    color: #333;
                ">
                    <span style="
                        margin-right: 10px;
                        color: #FF9933;
                        font-weight: bold;
                    ">•</span> 
                    Complete levels
                </li>
            </ul>
        </div>

        <div style="
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        ">
            <label style="
                display: flex; 
                align-items: center; 
                cursor: pointer;
                color: #333;
            ">
                <input 
                    type="checkbox" 
                    id="game-start-checkbox" 
                    style="
                        margin-right: 10px;
                        width: 18px;
                        height: 18px;
                    "
                >
                I understand the rules
            </label>
        </div>

        <button 
            id="start-game-btn"
            disabled
            style="
                width: 100%;
                background: #000080;
                color: white;
                border: none;
                padding: 12px 15px;
                border-radius: 8px;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-transform: uppercase;
                letter-spacing: 1px;
            "
        >
            Start Journey
        </button>
    </div>

    <style>
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        #player-name:focus {
            border-color: #FF9933;
            box-shadow: 0 0 10px rgba(255,153,51,0.3);
        }

        #start-game-btn:hover:not(:disabled) {
            background: #FF9933;
        }

        @media (max-width: 480px) {
            #game-start-modal > div {
                margin: 0 10px;
                padding: 20px;
            }
        }
    </style>
</div>
    <div id="game-container">
        <div class="game-header">
            <img src="https://upload.wikimedia.org/wikipedia/commons/1/17/Ashoka_Chakra.svg" 
                 alt="Ashoka Chakra" 
                 class="chakra-spin">
            <h1>Constitutional Journey</h1>
        </div>

        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-label">Score</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Level</div>
                <div class="stat-value" id="level">1</div>
            </div>
        </div>

        <div id="progress">Navigate through India's Constitutional Journey!</div>

        <div class="controls-panel">
            <div class="controls-title">
                <span>🎮</span> Controls
            </div>
            <div class="controls-grid">
                <div class="control-key">↑</div>
                <div class="control-key">↓</div>
                <div class="control-key">→</div>
                <div class="control-key">←</div>
                <div class="control-key">Space</div>
            </div>
        </div>
    </div>

    <div class="level-indicator">
        Level <span id="current-level">1</span>
    </div>

    <div id="minimap"></div>
    <!-- Add this section after the minimap div -->
<div id="game-info-buttons" style="
position: absolute;
top: 200px; 
right: 20px;
display: flex;
flex-direction: column;
gap: 10px;
z-index: 10;
">
<button id="instructions-btn" style="
    background: #FF9933;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 150px;
    justify-content: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
">
    📖 Instructions
</button>
<button id="leaderboard-btn" style="
    background: #000080;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 150px;
    justify-content: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
">
    🏆 Leaderboard
</button>
<button id="achievements-btn" style="
    background: #138808;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 150px;
    justify-content: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
">
    🎉 Achievements
</button>
</div>

<!-- Keep the modal overlay code from the previous example -->
<div id="modal-overlay" style="
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 1100;
justify-content: center;
align-items: center;
padding: 20px;
box-sizing: border-box;
">
<div id="modal-content" style="
    background: white;
    border-radius: 15px;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
">
    <button id="close-modal" style="
        position: absolute;
        top: 10px;
        right: 10px;
        background: #FF9933;
        color: white;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 18px;
    ">
        ✕
    </button>
    <h2 id="modal-title" style="
        color: #000080;
        margin-bottom: 20px;
        text-align: center;
    "></h2>
    <div id="modal-body" style="
        color: #333;
        line-height: 1.6;
    "></div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const modalOverlay = document.getElementById('modal-overlay');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const closeModalBtn = document.getElementById('close-modal');

    // Modal close functionality
    closeModalBtn.addEventListener('click', () => {
        modalOverlay.style.display = 'none';
    });

    // Close modal when clicking outside
    modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
            modalOverlay.style.display = 'none';
        }
    });

    // Instructions Modal
    document.getElementById('instructions-btn').addEventListener('click', () => {
        modalTitle.textContent = 'Detailed Game Instructions';
        modalBody.innerHTML = `
            <ol>
                <li><strong>Game Objective:</strong> Navigate through the constitutional maze, collect coins, and answer trivia questions.</li>
                <li><strong>Movement:</strong> Use arrow keys (↑ ↓ ← →) to move through the maze.</li>
                <li><strong>Coin Collection:</strong> 
                    <ul>
                        <li>Each coin triggers a constitutional trivia question</li>
                        <li>Correct answers earn you points</li>
                        <li>Incorrect answers may have penalties</li>
                    </ul>
                </li>
                <li><strong>Levels:</strong>
                    <ul>
                        <li>Difficulty increases with each level</li>
                        <li>Maze complexity and trivia challenge grow</li>
                    </ul>
                </li>
                <li><strong>Goal:</strong> Reach the end block while collecting maximum coins and answering questions correctly.</li>
            </ol>
        `;
        modalOverlay.style.display = 'flex';
    });

    // Leaderboard Modal
    document.getElementById('leaderboard-btn').addEventListener('click', () => {
        modalTitle.textContent = 'Constitutional Journey Leaderboard';
        modalBody.innerHTML = `
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="padding: 10px; text-align: left;">Rank</th>
                        <th style="padding: 10px; text-align: left;">Player</th>
                        <th style="padding: 10px; text-align: right;">Score</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 10px;">1</td>
                        <td style="padding: 10px;">Constitutional Scholar</td>
                        <td style="padding: 10px; text-align: right;">5000</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;">2</td>
                        <td style="padding: 10px;">Legal Eagle</td>
                        <td style="padding: 10px; text-align: right;">4750</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;">3</td>
                        <td style="padding: 10px;">Polity Pro</td>
                        <td style="padding: 10px; text-align: right;">4500</td>
                    </tr>
                </tbody>
            </table>
            <p style="text-align: center; color: #666; margin-top: 15px;">
                * Leaderboard updates after each game completion
            </p>
        `;
        modalOverlay.style.display = 'flex';
    });

    // Achievements Modal
    document.getElementById('achievements-btn').addEventListener('click', () => {
        modalTitle.textContent = 'Achievements';
        modalBody.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                <div style="text-align: center; background: #f9f9f9; padding: 15px; border-radius: 10px;">
                    <div style="font-size: 40px;">🏅</div>
                    <h3>First Journey</h3>
                    <p>Complete first level</p>
                </div>
                <div style="text-align: center; background: #f9f9f9; padding: 15px; border-radius: 10px;">
                    <div style="font-size: 40px;">📚</div>
                    <h3>Quiz Master</h3>
                    <p>Answer 10 consecutive trivia questions</p>
                </div>
                <div style="text-align: center; background: #f9f9f9; padding: 15px; border-radius: 10px;">
                    <div style="font-size: 40px;">🏆</div>
                    <h3>Constitutional Champion</h3>
                    <p>Complete all levels</p>
                </div>
            </div>
        `;
        modalOverlay.style.display = 'flex';
    });
});
</script>
    <div id="quiz-modal">
        <div class="modal-content">
            <div class="quiz-header">
                <h2 id="quiz-question">Question goes here</h2>
            </div>
            <div id="quiz-options" class="modal-options">
                <!-- Options will be dynamically added here -->
            </div>
        </div>
    </div>

    <div id="game-overlay">
        <div class="message-box">
            <h3 class="message-title">Level Complete!</h3>
            <p class="message-content">Ready for the next challenge?</p>
            <button class="btn btn-primary" onclick="nextLevel()">Continue</button>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    function generateMaze(width, height, complexity) {
    const maze = Array(height).fill().map(() => Array(width).fill(1));
    const start = { x: 1, y: 1 };
    const end = { x: width - 2, y: height - 2 };
    
    // Improved maze generation with guaranteed path
    function createPath() {
        let currentX = start.x;
        let currentY = start.y;
        maze[currentY][currentX] = 0;

        // Create a path to the end
        while (currentX !== end.x || currentY !== end.y) {
            // Decide next move with bias towards end
            const possibleMoves = [
                { dx: 1, dy: 0, condition: () => currentX < end.x },
                { dx: -1, dy: 0, condition: () => currentX > end.x },
                { dx: 0, dy: 1, condition: () => currentY < end.y },
                { dx: 0, dy: -1, condition: () => currentY > end.y }
            ].filter(move => 
                move.condition() &&
                currentX + move.dx > 0 && 
                currentX + move.dx < width - 1 &&
                currentY + move.dy > 0 && 
                currentY + move.dy < height - 1
            );

            if (possibleMoves.length === 0) break;

            const chosenMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
            currentX += chosenMove.dx;
            currentY += chosenMove.dy;
            
            // Clear path
            maze[currentY][currentX] = 0;
            
            // Occasionally add some randomness to path
            if (Math.random() < 0.3) {
                const randomDir = [
                    {dx: 1, dy: 0}, {dx: -1, dy: 0}, 
                    {dx: 0, dy: 1}, {dx: 0, dy: -1}
                ][Math.floor(Math.random() * 4)];
                
                const newX = currentX + randomDir.dx;
                const newY = currentY + randomDir.dy;
                
                if (newX > 0 && newX < width - 1 && newY > 0 && newY < height - 1) {
                    maze[newY][newX] = 0;
                }
            }
        }
    }

    // Create initial path
    createPath();

    // Mark start and end
    maze[start.y][start.x] = 2; // Start
    maze[end.y][end.x] = 3; // End

    // Add some additional randomness to make maze more interesting
    for (let i = 0; i < complexity * 10; i++) {
        const x = Math.floor(Math.random() * (width - 2)) + 1;
        const y = Math.floor(Math.random() * (height - 2)) + 1;
        
        // Only modify cells that are not start, end, or on critical path
        if (maze[y][x] === 1) {
            maze[y][x] = Math.random() < 0.5 ? 0 : 1;
        }
    }

    // Add coins based on complexity
    const coinCount = Math.floor((width * height) / (12 - complexity));
    let coinsPlaced = 0;
    while (coinsPlaced < coinCount) {
        const x = Math.floor(Math.random() * (width - 2)) + 1;
        const y = Math.floor(Math.random() * (height - 2)) + 1;
        if (maze[y][x] === 0) {
            maze[y][x] = 4; // Coin
            coinsPlaced++;
        }
    }

    return maze;
}

    let currentLevel = 1;
    let mazeStructure = generateMaze(9, 9, currentLevel);
    let currentPosition = { x: 1, z: 1 };
    let score = 0;

    // Three.js setup with improved visuals
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xE8F6F3);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // Enhanced lighting
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 5);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
    scene.add(ambientLight);

    // Improved materials with textures
    const wallMaterial = new THREE.MeshPhongMaterial({ 
        color: 0xFF9933,
        specular: 0x555555,
        shininess: 30
    });

    const floorMaterial = new THREE.MeshPhongMaterial({ 
        color: 0x138808,
        specular: 0x222222,
        shininess: 10
    });

    const goalMaterial = new THREE.MeshPhongMaterial({ 
        color: 0xFF0000,
        emissive: 0x000033,
        specular: 0xffffff,
        shininess: 100
    });

    const playerMaterial = new THREE.MeshPhongMaterial({ 
        color: 0xFFD700,
        emissive: 0x444400,
        specular: 0xffffff,
        shininess: 100
    });

    const coinMaterial = new THREE.MeshPhongMaterial({ 
        color: 0xffd700, 
        emissive: 0xffaa00,
        specular: 0xffffff,
        shininess: 100
    });

    const coins = [];

    function createMaze() {
        // Clear existing maze
        while(scene.children.length > 0){ 
            scene.remove(scene.children[0]); 
        }
        coins.length = 0;

        const cellSize = 1;
        const wallHeight = 1.5;
        const mazeWidth = mazeStructure[0].length;
        const mazeHeight = mazeStructure.length;

        mazeStructure.forEach((row, z) => {
            row.forEach((cell, x) => {
                const position = { x: x * cellSize, y: 0, z: z * cellSize };
                
                if (cell === 1) {
                    const wall = new THREE.Mesh(
                        new THREE.BoxGeometry(cellSize, wallHeight, cellSize),
                        wallMaterial
                    );
                    wall.position.set(position.x, wallHeight / 2, position.z);
                    wall.castShadow = true;
                    wall.receiveShadow = true;
                    scene.add(wall);
                } else if (cell === 3) {
                    const goal = new THREE.Mesh(
                        new THREE.BoxGeometry(cellSize, wallHeight/2, cellSize),
                        goalMaterial
                    );
                    goal.position.set(position.x, wallHeight / 4, position.z);
                    goal.castShadow = true;
                    goal.receiveShadow = true;
                    scene.add(goal);
                } else if (cell === 4) {
                    const coin = new THREE.Mesh(
                        new THREE.TorusGeometry(0.2, 0.05, 16, 32),
                        coinMaterial
                    );
                    coin.position.set(position.x, 0.3, position.z);
                    coin.rotation.x = Math.PI / 2;
                    coins.push({ x, z, mesh: coin });
                    scene.add(coin);
                } else if (cell === 2) {
                    currentPosition = { x, z };
                }
            });
        });

        // Create floor
        const floor = new THREE.Mesh(
            new THREE.PlaneGeometry(mazeWidth, mazeHeight),
            floorMaterial
        );
        floor.rotation.x = -Math.PI / 2;
        floor.position.set(
            (mazeWidth - 1) / 2, 
            -0.5, 
            (mazeHeight - 1) / 2
        );
        floor.receiveShadow = true;
        scene.add(floor);

        // Add lighting
        scene.add(new THREE.DirectionalLight(0xffffff, 1));
        scene.add(new THREE.AmbientLight(0x404040));
    }

    let player;
function createPlayer() {
    const geometry = new THREE.SphereGeometry(0.3, 16, 16);
    player = new THREE.Mesh(geometry, playerMaterial);
    player.position.set(currentPosition.x, 0.3, currentPosition.z);
    player.castShadow = true;
    scene.add(player);
}

    function updateMinimap() {
        const minimap = document.getElementById('minimap');
        minimap.innerHTML = '';
        const table = document.createElement('table');
        table.style.borderCollapse = 'collapse';

        mazeStructure.forEach((row, i) => {
            const tr = document.createElement('tr');
            row.forEach((cell, j) => {
                const td = document.createElement('td');
                td.style.width = '15px';
                td.style.height = '15px';
                td.style.border = '1px solid #ccc';

                if (i === currentPosition.z && j === currentPosition.x) {
                    td.style.backgroundColor = '#0000FF';
                } else {
                    switch(cell) {
                        case 0: td.style.backgroundColor = '#fff'; break;
                        case 1: td.style.backgroundColor = '#FF9933'; break;
                        case 2: td.style.backgroundColor = '#00ff00'; break;
                        case 3: td.style.backgroundColor = '#FF0000'; break;
                        case 4: td.style.backgroundColor = '#ffd700'; break;
                    }
                }
                tr.appendChild(td);
            });
            table.appendChild(tr);
        });
        minimap.appendChild(table);
    }

    function nextLevel() {
    currentLevel++;
    document.getElementById('level').textContent = currentLevel;
    document.getElementById('current-level').textContent = currentLevel;
    
    // Generate new, more complex maze
    const size = Math.min(9 + Math.floor(currentLevel/2), 15);
    mazeStructure = generateMaze(size, size, currentLevel);
    
    // Reset game state
    while(scene.children.length > 0){ 
        scene.remove(scene.children[0]); 
    }
    coins.length = 0;
    
    createMaze();
    createPlayer();
    document.getElementById('game-overlay').style.display = 'none';
    updateMinimap();

    // Update camera position for new maze size
    camera.position.set(
        mazeStructure[0].length / 2,
        mazeStructure[0].length * 0.8,
        mazeStructure.length * 1.2
    );
    camera.lookAt(
        mazeStructure[0].length / 2,
        0,
        mazeStructure.length / 2
    );
}
let currentQuizQuestion = null;
let currentCoinIndex = null;

// Make sure the constitutionQuestions array is defined at the top of your script
const constitutionQuestions = [
    {
        question: "Who is considered the Father of the Indian Constitution?",
        options: ["Mahatma Gandhi", "Dr. B.R. Ambedkar", "Jawaharlal Nehru", "Sardar Patel"],
        correctAnswers: ["Dr. B.R. Ambedkar", "2"]
    },
    {
        question: "In which year was the Constitution of India adopted?",
        options: ["1947", "1950", "1952", "1948"],
        correctAnswers: ["1950", "2"]
    },
    // ... (rest of the questions from the previous code)
];

    function movePlayer(direction) {
    const moves = {
        forward: { dx: 0, dz: -1 },
        backward: { dx: 0, dz: 1 },
        left: { dx: -1, dz: 0 },
        right: { dx: 1, dz: 0 }
    };

    const move = moves[direction];
    const newX = currentPosition.x + move.dx;
    const newZ = currentPosition.z + move.dz;

    if (
        newZ >= 0 && newZ < mazeStructure.length &&
        newX >= 0 && newX < mazeStructure[0].length &&
        mazeStructure[newZ][newX] !== 1
    ) {
        currentPosition.x = newX;
        currentPosition.z = newZ;
        player.position.set(currentPosition.x, 0.3, currentPosition.z);
        handleCoinCollision();
        updateMinimap();

        if (mazeStructure[newZ][newX] === 3) {
            document.getElementById('progress').textContent = "Level Complete!";
            document.getElementById('game-overlay').style.display = 'flex';
            setTimeout(() => {
                nextLevel();
            }, 1500);
        }
    }
}
    function handleCoinCollision() {
    const coinIndex = coins.findIndex(
        coin => Math.abs(coin.x - currentPosition.x) < 0.5 && 
                Math.abs(coin.z - currentPosition.z) < 0.5
    );
    
    if (coinIndex !== -1) {
        const questionIndex = Math.floor(Math.random() * constitutionQuestions.length);
        showQuizModal(constitutionQuestions[questionIndex], coinIndex);
    }
}
    // Initialize game
    createMaze();
    createPlayer();
    updateMinimap();

    // Camera setup
    camera.position.set(
        mazeStructure[0].length / 2,
        mazeStructure[0].length * 0.8,
        mazeStructure.length * 1.2
    );
    camera.lookAt(
        mazeStructure[0].length / 2,
        0,
        mazeStructure.length / 2
    );

    // Animation loop
    function animate() {
        requestAnimationFrame(animate);
        
        // Rotate coins
        coins.forEach(coin => {
            coin.mesh.rotation.y += 0.02;
        });

        renderer.render(scene, camera);
    }
    animate();

    // Handle window resizing
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
    window.addEventListener('keydown', (event) => {
    switch (event.key) {
        case 'ArrowUp': movePlayer('forward'); break;
        case 'ArrowDown': movePlayer('backward'); break;
        case 'ArrowLeft': movePlayer('left'); break;
        case 'ArrowRight': movePlayer('right'); break;
    }
});
    function showQuizModal(questionObj, coinIndex) {
    currentQuizQuestion = questionObj;
    currentCoinIndex = coinIndex;

    // Set question text
    document.getElementById('quiz-question').textContent = questionObj.question;

    // Clear previous options
    const optionsContainer = document.getElementById('quiz-options');
    optionsContainer.innerHTML = '';

    // Create option buttons
    questionObj.options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'modal-option';
        optionElement.textContent = option;
        optionElement.onclick = () => checkAnswer(option, index + 1);
        optionsContainer.appendChild(optionElement);
    });

    // Show modal
    document.getElementById('quiz-modal').style.display = 'block';
}
function checkAnswer(selectedOption, selectedIndex) {
    document.getElementById('quiz-modal').style.display = 'none';
    
    const isCorrectAnswer = currentQuizQuestion.correctAnswers.includes(selectedOption) || 
                           currentQuizQuestion.correctAnswers.includes(selectedIndex.toString());

    if (isCorrectAnswer) {
        scene.remove(coins[currentCoinIndex].mesh);
        coins.splice(currentCoinIndex, 1);
        score += 10;
        document.getElementById('score').textContent = score;
        document.getElementById('progress').textContent = "Correct! Keep exploring!";
    } else {
        document.getElementById('progress').textContent = "Incorrect! Try another question!";
    }
}
document.addEventListener('DOMContentLoaded', () => {
    const playerNameInput = document.getElementById('player-name');
    const gameStartCheckbox = document.getElementById('game-start-checkbox');
    const startGameBtn = document.getElementById('start-game-btn');
    const gameStartModal = document.getElementById('game-start-modal');

    // Enable start button only when name is entered and checkbox is checked
    function validateStartGame() {
        startGameBtn.disabled = !(playerNameInput.value.trim() && gameStartCheckbox.checked);
    }

    playerNameInput.addEventListener('input', validateStartGame);
    gameStartCheckbox.addEventListener('change', validateStartGame);

    startGameBtn.addEventListener('click', () => {
        const playerName = playerNameInput.value.trim();
        
        // Store player name (you can use this later for high scores, etc.)
        localStorage.setItem('playerName', playerName);
        
        // Update score display with player name
        document.getElementById('progress').innerHTML = 
            `Welcome, ${playerName}! Navigate through India's Constitutional Journey!`;
        
        // Hide start modal
        gameStartModal.style.display = 'none';

        // Initialize game
        createMaze();
        createPlayer();
        updateMinimap();
    });
});
</script>
</body>
</html>